name: üß™ Safetica Teams Playwright Tests

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  test:
    name: üê≥ Run Playwright Tests in Docker
    runs-on: windows-latest
    environment: qa

    env:
      TEAMS_LOGIN: ${{ secrets.TEAMS_LOGIN }}
      TEAMS_PASSWORD: ${{ secrets.TEAMS_PASSWORD }}
      TEAMS_CHAT_NAME: ${{ secrets.TEAMS_CHAT_NAME }}
      TEAMS_BASE_URL: ${{ secrets.TEAMS_BASE_URL }}
      HEADLESS: "true"

    steps:
      - name: üßæ Checkout repository
        uses: actions/checkout@v3

      - name: üê≥ Run tests inside Docker container
        run: |
          docker run --rm ^
            -v "${{ github.workspace }}:/app" ^
            -w /app ^
            -e TEAMS_LOGIN="${{ secrets.TEAMS_LOGIN }}" ^
            -e TEAMS_PASSWORD="${{ secrets.TEAMS_PASSWORD }}" ^
            -e TEAMS_CHAT_NAME="${{ secrets.TEAMS_CHAT_NAME }}" ^
            -e TEAMS_BASE_URL="${{ secrets.TEAMS_BASE_URL }}" ^
            -e HEADLESS="true" ^
            my-playwright-dotnet:latest ^
            pwsh bin/Debug/net8.0/playwright.ps1 install ; dotnet test --logger:"console;verbosity=detailed"

      - name: üì∏ Upload screenshots (if any)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: screenshots
          path: "*.png"